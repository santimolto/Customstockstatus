<?php
/** @var \Magento\Framework\View\Element\Template $block */

$product = $block->getProduct() ?? $block->getData('product');
if (!$product || !$product->getId()) return;

$stockStatus = $product->getCustomStockStatus();

try {
    $stockRegistry = \Magento\Framework\App\ObjectManager::getInstance()
        ->get(\Magento\CatalogInventory\Api\StockRegistryInterface::class);
    $stockItem = $stockRegistry->getStockItem($product->getId());
    $qty = $stockItem && $stockItem->getItemId() ? (int)$stockItem->getQty() : null;
} catch (\Exception $e) {
    $qty = null;
}

if ($stockStatus):
    if ($qty !== null && strpos($stockStatus, '{qty}') !== false):
        $translated = str_replace('{qty}', $qty, __('%1 in stock', $qty));
    else:
        $translated = __($stockStatus);
    endif;
    ?>
    <div class="custom-stock-status text-sm text-gray-700 font-medium my-1">
        <?= $block->escapeHtml($translated) ?>
    </div>
<?php endif; ?>
